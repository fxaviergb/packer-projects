
# Packer Template for NGINX and Node.js Deployment on Ubuntu

This repository contains a Packer template for creating a custom Amazon Machine Image (AMI) that sets up an Ubuntu server with NGINX and Node.js. The template also configures security group rules to enable HTTP (port 80) and HTTPS (port 443) traffic.

## Key Features

- Uses an **IAM Instance Profile** to define permissions for enabling HTTP and HTTPS ports.
- Installs and configures **Node.js** with a sample application.
- Installs and configures **NGINX** as a reverse proxy for the Node.js application.
- Configures security group ingress rules dynamically during the build process.

## Prerequisites

Before using this template, ensure that you have:

1. An AWS account and credentials configured.
2. [Packer](https://www.packer.io/downloads) installed on your local machine.
3. An **IAM Role** (e.g., `my-ec2-role`) with the necessary permissions to manage EC2 instances and security groups (needed in `nginx-nodejs-ubuntu-ami-with-iam-instance-profile` template).
4. An **EC2 Security Group ID** (e.g., `sg-21wqsxxxxx`) with ingress rules to acces HTTP 80 port (needed in `nginx-nodejs-ubuntu-ami-with-security-group` template).

## AWS Credentials

The template automatically uses AWS credentials stored in the `~/.aws/credentials` file, created by the AWS CLI. Ensure you have the AWS CLI installed and configured on your system:

1. Install the AWS CLI by following the [official guide](https://docs.aws.amazon.com/cli/latest/userguide/install-cliv2.html).
2. Run the following command to configure your credentials:
   ```bash
   aws configure
   ```
3. Provide your AWS Access Key ID, Secret Access Key, region, and output format when prompted. The credentials will be saved in the `~/.aws/credentials` file.

## How the Template Works

1. **Source Configuration**:
   The `amazon-ebs` source is used to create an AMI based on an Ubuntu 20.04 LTS base image.

2. **Shell Provisioners**:
   - The first provisioner installs the AWS CLI and configures security group rules for ports 80 and 443.
   - The second provisioner sets up Node.js, creates a sample Node.js application, and configures NGINX as a reverse proxy.

3. **Build Block**:
   The `build` block ties everything together and generates a custom AMI with the desired setup.

## Deployment Steps

Follow these steps to deploy the template:

### 1. Clone the Repository

```bash
git clone <REPOSITORY-URL>
cd <REPOSITORY-FOLDER>
```

### 2. Initialize Packer

Ensure that all required plugins are installed:

```bash
packer init <template.pkr.hcl>
```

### 3. Validate the Template

Check the template syntax to ensure there are no errors:

```bash
packer validate <template.pkr.hcl>
```

### 4. Build the AMI

Run the build command to create the AMI:

```bash
packer build <template.pkr.hcl>
```

### 5. Deploy the AMI

After the build process completes, use the AMI ID generated by Packer to launch an EC2 instance from the AWS Management Console or CLI.

## Testing the Deployed Node.js Application

After launching an EC2 instance using the created AMI, follow these steps to test the Node.js application:

1. **Obtain the Public IP Address of the Instance**:
   Go to the AWS Management Console, navigate to the EC2 section, and find the public IP address of your instance.

2. **Access the Application**:
   - Open your web browser and go to `http://<PUBLIC_IP>` to verify that NGINX is correctly proxying traffic to the Node.js application.
   - Test the Node.js application endpoint by navigating to `http://<PUBLIC_IP>/hello`. You should see the response:
     ```
     World
     ```

3. **Using `curl` for Testing**:
   Alternatively, you can use the `curl` command to test the application:
   ```bash
   curl http://<PUBLIC_IP>/hello
   ```

   The expected output is:
   ```
   World
   ```

## Sample Configuration Overview

- **AMI Base**: Ubuntu 20.04 LTS
- **Instance Type**: `t2.micro` (modifiable in the template)
- **IAM Instance Profile**: `my-ec2-role` (replace with your IAM role name)

## Security Group Configuration

The template dynamically configures the following ingress rules for the instance's security group:

- **Port 80**: Enables HTTP traffic from all IP addresses (`0.0.0.0/0`).

## License

This repository is licensed under the MIT License. See the `LICENSE` file for more details.